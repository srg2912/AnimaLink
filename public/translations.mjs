// src/translations.mjs
const translations = {
    en: {
        // Splash
        splashLoading: "AnimaLink Loading...",
        // Language Selection Screen
        languageSelectTitle: "Select Language",
        languageSelectLabel: "Choose your preferred language:",
        languageSelectContinue: "Continue",
        // API Key Screen
        apiKeyConfigTitle: "API Key Configuration",
        modelLabel: "Model:",
        modelPlaceholder: "e.g., gpt-4-vision-preview",
        apiKeyLabel: "API Key:",
        apiKeyPlaceholder: "Your API Key",
        endpointLabel: "Endpoint URL:",
        endpointPlaceholder: "e.g., https://api.openai.com/v1",
        supportsVisionLabel: "This model supports vision",
        saveApiKeyButton: "Save API Key",
        // User Data Screen
        userDataTitle: "Your Information",
        userNameLabel: "Name*:",
        userNamePlaceholder: "Your Name",
        nicknameLabel: "Nickname:",
        nicknamePlaceholder: "Nickname (Optional)",
        genderLabel: "Gender*:",
        genderPlaceholder: "Your Gender",
        pronounsLabel: "Pronouns*:",
        pronounsPlaceholder: "e.g., she/her, he/him, they/them",
        ageLabel: "Age:",
        agePlaceholder: "Your Age (Optional)",
        hobbiesLabel: "Hobbies (comma-separated):",
        hobbiesPlaceholder: "e.g., reading, gaming (Optional)",
        userPersonalityLabel: "Your Personality (briefly):",
        userPersonalityPlaceholder: "A short description (Optional)",
        saveUserDataButton: "Save User Data",
        updateUserDataButton: "Update User Data",
        // Character Choice Screen
        charChoiceTitle: "Character Setup",
        charChoicePrompt: "Would you like to create a new character or restore an existing one?",
        charChoiceCreateNew: "Create New Character",
        charChoiceShowRestore: "Restore Existing Character",
        charChoiceRestoreSectionTitle: "Select a backup to restore:",
        charChoiceRestoreButton: "Restore Selected Backup",
        charChoiceNoBackups: "No backups found.",
        charChoiceSelectBackup: "Select a backup",
        charChoiceLoadingBackups: "Loading backups...",
        charChoiceErrorLoadingBackups: "Error loading backups",
        // Character Setup Screen
        charCreateTitle: "Create Your Character",
        charNameLabel: "Character Name*:",
        charNamePlaceholder: "Character's Name",
        charLooksLabel: "Character Gender*:",
        charLooksPlaceholder: "e.g., female, male, non-binary",
        charPersonalityDescLabel: "Character Personality Description*:",
        charPersonalityDescPlaceholder: "Describe their personality",
        charLangLabel: "Character Language*:",
        charLangPlaceholder: "e.g., English, Spanish", // This is for AI language
        charSpriteFolderLabel: "Sprite Folder To Use*:",
        charSpriteFolderLoading: "Loading sprite folders...",
        charSpriteFolderSelect: "Select a sprite folder",
        charSpriteFolderNotFound: "No sprite folders found",
        charSpriteFolderError: "Error loading folders",
        generateProfileButton: "Generate Character Profile",
        regenerateProfileButton: "Regenerate Profile",
        charEditSectionTitle: "Generated Profile (Edit if needed)",
        saveEditedProfileButton: "Save Edited Profile",
        saveAllCharDataButton: "Save All Data",
        continueToGameButton: "Continue to Game",
        // Game Screen & Controls
        optionsButton: "☰ Options",
        changeBgButton: "Background",
        musicSettingsButton: "Music",
        actionPerformButton: "Perform",
        actionHug: "Hug",
        actionTickle: "Tickle",
        actionKiss: "Kiss",
        actionPetHead: "Pet head",
        actionHoldHand: "Hold hand",
        actionHighFive: "High five",
        actionGiveMassage: "Give massage",
        attachImageButtonTitle: "Attach Image",
        userMessagePlaceholder: "Type your message...",
        sendMessageButtonTitle: "Send Message",
        // Options Modal
        optionsTitle: "Options",
        supportsVisionCheckboxLabel: "The current model supports vision",
        optChangeApiKey: "Change API Key",
        optChangeUserData: "Change Your Data",
        optChangeCharProfile: "Edit Character Profile",
        optViewChatHistory: "View Chat History",
        optViewCharDiary: "View Character Diary",
        optCreateBackup: "Create Backup",
        optCreateBaseBackup: "Create Base Character File",
        optRestoreCharacter: "Restore Character",
        optOpenModdingFolder: "Open Modding Folder",
        optCreateNewChar: "Create New Character",
        optChangeLanguage: "Change Language",
        // Memory Viewer Modal
        memoryViewerTitleDefault: "Memory",
        memoryViewerNoEntries: "No entries.",
        memoryViewerChatHistoryTitle: "Chat History",
        memoryViewerCharDiaryTitle: "Character's Diary",
        memoryViewerErrorLoading: "Failed to load.",
        // Background Selector Modal
        changeBgModalTitle: "Change Background",
        selectBgLabel: "Select a background:",
        applyBgButton: "Apply Background",
        bgSelectorNoBgs: "No backgrounds found.",
        // Music Settings Modal
        musicSettingsModalTitle: "Music Settings",
        selectMusicTrackLabel: "Select Track:",
        musicVolumeLabel: "Volume:",
        musicSelectorNoMusic: "No music found.",
        // Restore Backup Modal (Options)
        restoreBackupModalTitle: "Restore Character from Backup",
        restoreBackupWarning: "<strong>Warning:</strong> Restoring a backup will overwrite the current character's data and chat history. Please make a backup of the current character first if needed.",
        selectBackupLabel: "Select a backup to restore:",
        applyRestoreBackupButton: "Restore Selected Backup",
        // Confirmation Modal
        confirmActionTitle: "Confirm Action",
        confirmYes: "Yes",
        confirmNo: "No",
        // Common Error/Notification Messages (use placeholders like {name})
        errorAllFieldsRequired: "All fields with * are required.",
        errorSpriteFolderMissing: "Error: Sprite folder not set.",
        errorFailedToLoadChat: "Failed to load chat history.",
        errorApiNotConfigured: "API Key not configured or is invalid.",
        errorUserDataNotFound: "User data not found.",
        errorCharProfileNotFound: "Character profile and general info not found.",
        errorCoreDetailsRequired: "Core details (Name, Gender, Language, Sprite) are required.",
        errorProfileOrDescRequired: "Profile text or personality description must be filled.",
        llmInteractionFailed: "LLM interaction failed.",
        llmInteractionFailedResponse: "Sorry, I had trouble responding. ({errorMessage})",
        errorNetworkError: "Network error: {message}. Server running?",
        errorNonJsonResponse: "Server returned non-JSON response (Status {status}). Check console.",
        errorRequestFailed: "Request failed: {status} {statusText}",
        errorGenericError: "Error.",
        errorFetchBackupList: "Error trying to fetch backup list:",
        notificationUserDataUpdated: "User data updated!",
        notificationCharRegenerated: "Character regenerated!",
        notificationCharSaved: "Character saved!",
        notificationVisionEnabled: "Vision support enabled.",
        notificationVisionDisabled: "Vision support disabled.",
        notificationFailedUpdateVision: "Failed to update vision setting.",
        notificationCouldNotLoadProfileEdit: "Could not load profile for editing.",
        notificationCurrentDataDeleted: "Current character data deleted.",
        notificationFailedToDeleteData: "Failed to delete data: {error}",
        notificationBackupCreated: "Backup for {characterName} created successfully.",
        notificationBackupFailed: "Backup failed: {error}",
        notificationBaseBackupCreated: "Base backup file for '{characterName}' created successfully.",
        notificationBaseBackupFailed: "Base backup creation failed: {error}",
        notificationRestoreSuccess: "Memory for '{characterName}' (from {backupFileName}) restored successfully.",
        notificationRestoreFailed: "Restore failed: {error}",
        notificationSelectABackup: "Please select a backup.",
        notificationInvalidFileType: "Invalid file type.",
        notificationFileTooLarge: "File too large (max 7MB).",
        notificationSelectBackground: "Select a background.",
        notificationErrorOpenModdingFolder: "Error: Could not open modding folder.",
        charDeleteConfirmationTitle: "Create New Confirmation",
        charDeleteConfirmationMessage: "This deletes current character data.\nBackup first if needed.\n\nContinue?",
    },
    es: {
        // Splash
        splashLoading: "AnimaLink Cargando...",
        // Language Selection Screen
        languageSelectTitle: "Seleccionar Idioma",
        languageSelectLabel: "Elige tu idioma preferido:",
        languageSelectContinue: "Continuar",
        // API Key Screen
        apiKeyConfigTitle: "Configuración de Clave API",
        modelLabel: "Modelo:",
        modelPlaceholder: "ej., gpt-4-vision-preview",
        apiKeyLabel: "Clave API:",
        apiKeyPlaceholder: "Tu Clave API",
        endpointLabel: "URL del Endpoint:",
        endpointPlaceholder: "ej., https://api.openai.com/v1",
        supportsVisionLabel: "Este modelo soporta visión",
        saveApiKeyButton: "Guardar Clave API",
        // User Data Screen
        userDataTitle: "Tu Información",
        userNameLabel: "Nombre*:",
        userNamePlaceholder: "Tu Nombre",
        nicknameLabel: "Apodo:",
        nicknamePlaceholder: "Apodo (Opcional)",
        genderLabel: "Género*:",
        genderPlaceholder: "Tu Género",
        pronounsLabel: "Pronombres*:",
        pronounsPlaceholder: "ej., ella, él, elle",
        ageLabel: "Edad:",
        agePlaceholder: "Tu Edad (Opcional)",
        hobbiesLabel: "Hobbies (separados por coma):",
        hobbiesPlaceholder: "ej., leer, jugar videojuegos (Opcional)",
        userPersonalityLabel: "Tu Personalidad (brevemente):",
        userPersonalityPlaceholder: "Una breve descripción (Opcional)",
        saveUserDataButton: "Guardar Datos de Usuario",
        updateUserDataButton: "Actualizar Datos de Usuario",
        // Character Choice Screen
        charChoiceTitle: "Configuración de Personaje",
        charChoicePrompt: "¿Te gustaría crear un nuevo personaje o restaurar uno existente?",
        charChoiceCreateNew: "Crear Nuevo Personaje",
        charChoiceShowRestore: "Restaurar Personaje Existente",
        charChoiceRestoreSectionTitle: "Selecciona una copia de seguridad para restaurar:",
        charChoiceRestoreButton: "Restaurar Copia Seleccionada",
        charChoiceNoBackups: "No se encontraron copias de seguridad.",
        charChoiceSelectBackup: "Selecciona una copia",
        charChoiceLoadingBackups: "Cargando copias...",
        charChoiceErrorLoadingBackups: "Error al cargar copias",
        // Character Setup Screen
        charCreateTitle: "Crea Tu Personaje",
        charNameLabel: "Nombre del Personaje*:",
        charNamePlaceholder: "Nombre del Personaje",
        charLooksLabel: "Género del Personaje*:",
        charLooksPlaceholder: "ej., femenino, masculino, no binario",
        charPersonalityDescLabel: "Descripción de Personalidad del Personaje*:",
        charPersonalityDescPlaceholder: "Describe su personalidad",
        charLangLabel: "Idioma del Personaje*:",
        charLangPlaceholder: "ej., Inglés, Español",
        charSpriteFolderLabel: "Carpeta de Sprites a Usar*:",
        charSpriteFolderLoading: "Cargando carpetas de sprites...",
        charSpriteFolderSelect: "Selecciona una carpeta de sprites",
        charSpriteFolderNotFound: "No se encontraron carpetas de sprites",
        charSpriteFolderError: "Error al cargar carpetas",
        generateProfileButton: "Generar Perfil del Personaje",
        regenerateProfileButton: "Regenerar Perfil",
        charEditSectionTitle: "Perfil Generado (Edita si es necesario)",
        saveEditedProfileButton: "Guardar Perfil Editado",
        saveAllCharDataButton: "Guardar Todos los Datos",
        continueToGameButton: "Continuar al Juego",
        // Game Screen & Controls
        optionsButton: "☰ Opciones",
        changeBgButton: "Fondo",
        musicSettingsButton: "Música",
        actionPerformButton: "Realizar",
        actionHug: "Abrazar",
        actionTickle: "Hacer cosquillas",
        actionKiss: "Besar",
        actionPetHead: "Acariciar cabeza",
        actionHoldHand: "Tomar de la mano",
        actionHighFive: "Chocar los cinco",
        actionGiveMassage: "Dar masaje",
        attachImageButtonTitle: "Adjuntar Imagen",
        userMessagePlaceholder: "Escribe tu mensaje...",
        sendMessageButtonTitle: "Enviar Mensaje",
        // Options Modal
        optionsTitle: "Opciones",
        supportsVisionCheckboxLabel: "El modelo actual soporta visión",
        optChangeApiKey: "Cambiar Clave API",
        optChangeUserData: "Cambiar Tus Datos",
        optChangeCharProfile: "Editar Perfil del Personaje",
        optViewChatHistory: "Ver Historial de Chat",
        optViewCharDiary: "Ver Diario del Personaje",
        optCreateBackup: "Crear Copia de Seguridad",
        optCreateBaseBackup: "Crear Archivo Base de Personaje",
        optRestoreCharacter: "Restaurar Personaje",
        optOpenModdingFolder: "Abrir Carpeta de Modding",
        optCreateNewChar: "Crear Nuevo Personaje",
        optChangeLanguage: "Cambiar Idioma",
        // Memory Viewer Modal
        memoryViewerTitleDefault: "Memoria",
        memoryViewerNoEntries: "No hay entradas.",
        memoryViewerChatHistoryTitle: "Historial de Chat",
        memoryViewerCharDiaryTitle: "Diario del Personaje",
        memoryViewerErrorLoading: "Error al cargar.",
        // Background Selector Modal
        changeBgModalTitle: "Cambiar Fondo",
        selectBgLabel: "Selecciona un fondo:",
        applyBgButton: "Aplicar Fondo",
        bgSelectorNoBgs: "No se encontraron fondos.",
        // Music Settings Modal
        musicSettingsModalTitle: "Ajustes de Música",
        selectMusicTrackLabel: "Seleccionar Pista:",
        musicVolumeLabel: "Volumen:",
        musicSelectorNoMusic: "No se encontró música.",
        // Restore Backup Modal (Options)
        restoreBackupModalTitle: "Restaurar Personaje desde Copia",
        restoreBackupWarning: "<strong>Advertencia:</strong> Restaurar una copia de seguridad sobrescribirá los datos y el historial de chat del personaje actual. Por favor, haz una copia de seguridad del personaje actual primero si es necesario.",
        selectBackupLabel: "Selecciona una copia para restaurar:",
        applyRestoreBackupButton: "Restaurar Copia Seleccionada",
        // Confirmation Modal
        confirmActionTitle: "Confirmar Acción",
        confirmYes: "Sí",
        confirmNo: "No",
        // Common Error/Notification Messages
        errorAllFieldsRequired: "Todos los campos con * son obligatorios.",
        errorSpriteFolderMissing: "Error: Carpeta de sprites no configurada.",
        errorFailedToLoadChat: "Error al cargar el historial de chat.",
        errorApiNotConfigured: "Clave API no configurada o inválida.",
        errorUserDataNotFound: "Datos de usuario no encontrados.",
        errorCharProfileNotFound: "Perfil de personaje e información general no encontrados.",
        errorCoreDetailsRequired: "Los detalles principales (Nombre, Género, Idioma, Sprite) son obligatorios.",
        errorProfileOrDescRequired: "El texto del perfil o la descripción de la personalidad deben rellenarse.",
        llmInteractionFailed: "Falló la interacción con el LLM.",
        llmInteractionFailedResponse: "Lo siento, tuve problemas para responder. ({errorMessage})",
        errorNetworkError: "Error de red: {message}. ¿Servidor en ejecución?",
        errorNonJsonResponse: "El servidor devolvió una respuesta no JSON (Estado {status}). Revisa la consola.",
        errorRequestFailed: "Falló la solicitud: {status} {statusText}",
        errorGenericError: "Error.",
        errorFetchBackupList: "Error al intentar obtener la lista de copias de seguridad:",
        notificationUserDataUpdated: "¡Datos de usuario actualizados!",
        notificationCharRegenerated: "¡Personaje regenerado!",
        notificationCharSaved: "¡Personaje guardado!",
        notificationVisionEnabled: "Soporte de visión habilitado.",
        notificationVisionDisabled: "Soporte de visión deshabilitado.",
        notificationFailedUpdateVision: "Error al actualizar la configuración de visión.",
        notificationCouldNotLoadProfileEdit: "No se pudo cargar el perfil para editar.",
        notificationCurrentDataDeleted: "Datos del personaje actual eliminados.",
        notificationFailedToDeleteData: "Error al eliminar datos: {error}",
        notificationBackupCreated: "Copia de seguridad para {characterName} creada con éxito.",
        notificationBackupFailed: "Falló la copia de seguridad: {error}",
        notificationBaseBackupCreated: "Archivo base de personaje para '{characterName}' creado con éxito.",
        notificationBaseBackupFailed: "Falló la creación de la copia de seguridad base: {error}",
        notificationRestoreSuccess: "Memoria para '{characterName}' (de {backupFileName}) restaurada con éxito.",
        notificationRestoreFailed: "Falló la restauración: {error}",
        notificationSelectABackup: "Por favor, selecciona una copia de seguridad.",
        notificationInvalidFileType: "Tipo de archivo inválido.",
        notificationFileTooLarge: "Archivo demasiado grande (máx 7MB).",
        notificationSelectBackground: "Selecciona un fondo.",
        notificationErrorOpenModdingFolder: "Error: No se pudo abrir la carpeta de modding.",
        charDeleteConfirmationTitle: "Confirmación de Creación Nueva",
        charDeleteConfirmationMessage: "Esto elimina los datos del personaje actual.\nRealiza una copia de seguridad primero si es necesario.\n\n¿Continuar?",
    },
    it: {
        // Splash
        splashLoading: "AnimaLink Caricamento...",
        // Language Selection Screen
        languageSelectTitle: "Seleziona Lingua",
        languageSelectLabel: "Scegli la tua lingua preferita:",
        languageSelectContinue: "Continua",
        // API Key Screen
        apiKeyConfigTitle: "Configurazione Chiave API",
        modelLabel: "Modello:",
        modelPlaceholder: "es., gpt-4-vision-preview",
        apiKeyLabel: "Chiave API:",
        apiKeyPlaceholder: "La tua Chiave API",
        endpointLabel: "URL Endpoint:",
        endpointPlaceholder: "es., https://api.openai.com/v1",
        supportsVisionLabel: "Questo modello supporta la visione",
        saveApiKeyButton: "Salva Chiave API",
        // User Data Screen
        userDataTitle: "Le Tue Informazioni",
        userNameLabel: "Nome*:",
        userNamePlaceholder: "Il Tuo Nome",
        nicknameLabel: "Nickname:",
        nicknamePlaceholder: "Nickname (Opzionale)",
        genderLabel: "Genere*:",
        genderPlaceholder: "Il Tuo Genere",
        pronounsLabel: "Pronomi*:",
        pronounsPlaceholder: "es., lei, lui, loro",
        ageLabel: "Età:",
        agePlaceholder: "La Tua Età (Opzionale)",
        hobbiesLabel: "Hobby (separati da virgola):",
        hobbiesPlaceholder: "es., leggere, giocare (Opzionale)",
        userPersonalityLabel: "La Tua Personalità (brevemente):",
        userPersonalityPlaceholder: "Una breve descrizione (Opzionale)",
        saveUserDataButton: "Salva Dati Utente",
        updateUserDataButton: "Aggiorna Dati Utente",
        // Character Choice Screen
        charChoiceTitle: "Impostazione Personaggio",
        charChoicePrompt: "Vuoi creare un nuovo personaggio o ripristinarne uno esistente?",
        charChoiceCreateNew: "Crea Nuovo Personaggio",
        charChoiceShowRestore: "Ripristina Personaggio Esistente",
        charChoiceRestoreSectionTitle: "Seleziona un backup da ripristinare:",
        charChoiceRestoreButton: "Ripristina Backup Selezionato",
        charChoiceNoBackups: "Nessun backup trovato.",
        charChoiceSelectBackup: "Seleziona un backup",
        charChoiceLoadingBackups: "Caricamento backup...",
        charChoiceErrorLoadingBackups: "Errore caricamento backup",
        // Character Setup Screen
        charCreateTitle: "Crea il Tuo Personaggio",
        charNameLabel: "Nome Personaggio*:",
        charNamePlaceholder: "Nome del Personaggio",
        charLooksLabel: "Genere Personaggio*:",
        charLooksPlaceholder: "es., femmina, maschio, non binario",
        charPersonalityDescLabel: "Descrizione Personalità Personaggio*:",
        charPersonalityDescPlaceholder: "Descrivi la sua personalità",
        charLangLabel: "Lingua Personaggio*:",
        charLangPlaceholder: "es., Inglese, Italiano",
        charSpriteFolderLabel: "Cartella Sprite da Usare*:",
        charSpriteFolderLoading: "Caricamento cartelle sprite...",
        charSpriteFolderSelect: "Seleziona una cartella sprite",
        charSpriteFolderNotFound: "Nessuna cartella sprite trovata",
        charSpriteFolderError: "Errore caricamento cartelle",
        generateProfileButton: "Genera Profilo Personaggio",
        regenerateProfileButton: "Rigenera Profilo",
        charEditSectionTitle: "Profilo Generato (Modifica se necessario)",
        saveEditedProfileButton: "Salva Profilo Modificato",
        saveAllCharDataButton: "Salva Tutti i Dati",
        continueToGameButton: "Continua al Gioco",
        // Game Screen & Controls
        optionsButton: "☰ Opzioni",
        changeBgButton: "Sfondo",
        musicSettingsButton: "Musica",
        actionPerformButton: "Esegui",
        actionHug: "Abbraccia",
        actionTickle: "Solletica",
        actionKiss: "Bacia",
        actionPetHead: "Accarezza la testa",
        actionHoldHand: "Tieni la mano",
        actionHighFive: "Batti il cinque",
        actionGiveMassage: "Fai un massaggio",
        attachImageButtonTitle: "Allega Immagine",
        userMessagePlaceholder: "Scrivi il tuo messaggio...",
        sendMessageButtonTitle: "Invia Messaggio",
        // Options Modal
        optionsTitle: "Opzioni",
        supportsVisionCheckboxLabel: "Il modello corrente supporta la visione",
        optChangeApiKey: "Cambia Chiave API",
        optChangeUserData: "Cambia i Tuoi Dati",
        optChangeCharProfile: "Modifica Profilo Personaggio",
        optViewChatHistory: "Visualizza Cronologia Chat",
        optViewCharDiary: "Visualizza Diario Personaggio",
        optCreateBackup: "Crea Backup",
        optCreateBaseBackup: "Crea File Base Personaggio",
        optRestoreCharacter: "Ripristina Personaggio",
        optOpenModdingFolder: "Apri Cartella Modding",
        optCreateNewChar: "Crea Nuovo Personaggio",
        optChangeLanguage: "Cambia Lingua",
        // Memory Viewer Modal
        memoryViewerTitleDefault: "Memoria",
        memoryViewerNoEntries: "Nessuna voce.",
        memoryViewerChatHistoryTitle: "Cronologia Chat",
        memoryViewerCharDiaryTitle: "Diario del Personaggio",
        memoryViewerErrorLoading: "Caricamento fallito.",
        // Background Selector Modal
        changeBgModalTitle: "Cambia Sfondo",
        selectBgLabel: "Seleziona uno sfondo:",
        applyBgButton: "Applica Sfondo",
        bgSelectorNoBgs: "Nessuno sfondo trovato.",
        // Music Settings Modal
        musicSettingsModalTitle: "Impostazioni Musica",
        selectMusicTrackLabel: "Seleziona Traccia:",
        musicVolumeLabel: "Volume:",
        musicSelectorNoMusic: "Nessuna musica trovata.",
        // Restore Backup Modal (Options)
        restoreBackupModalTitle: "Ripristina Personaggio da Backup",
        restoreBackupWarning: "<strong>Attenzione:</strong> Il ripristino di un backup sovrascriverà i dati e la cronologia chat del personaggio corrente. Si prega di creare prima un backup del personaggio corrente, se necessario.",
        selectBackupLabel: "Seleziona un backup da ripristinare:",
        applyRestoreBackupButton: "Ripristina Backup Selezionato",
        // Confirmation Modal
        confirmActionTitle: "Conferma Azione",
        confirmYes: "Sì",
        confirmNo: "No",
        // Common Error/Notification Messages
        errorAllFieldsRequired: "Tutti i campi con * sono obbligatori.",
        errorSpriteFolderMissing: "Errore: Cartella sprite non impostata.",
        errorFailedToLoadChat: "Impossibile caricare la cronologia chat.",
        errorApiNotConfigured: "Chiave API non configurata o non valida.",
        errorUserDataNotFound: "Dati utente non trovati.",
        errorCharProfileNotFound: "Profilo personaggio e informazioni generali non trovati.",
        errorCoreDetailsRequired: "I dettagli principali (Nome, Genere, Lingua, Sprite) sono obbligatori.",
        errorProfileOrDescRequired: "Il testo del profilo o la descrizione della personalità devono essere compilati.",
        llmInteractionFailed: "Interazione LLM fallita.",
        llmInteractionFailedResponse: "Scusa, ho avuto problemi a rispondere. ({errorMessage})",
        errorNetworkError: "Errore di rete: {message}. Server in esecuzione?",
        errorNonJsonResponse: "Il server ha restituito una risposta non JSON (Stato {status}). Controlla la console.",
        errorRequestFailed: "Richiesta fallita: {status} {statusText}",
        errorGenericError: "Errore.",
        errorFetchBackupList: "Errore durante il tentativo di recuperare l'elenco dei backup:",
        notificationUserDataUpdated: "Dati utente aggiornati!",
        notificationCharRegenerated: "Personaggio rigenerato!",
        notificationCharSaved: "Personaggio salvato!",
        notificationVisionEnabled: "Supporto visione abilitato.",
        notificationVisionDisabled: "Supporto visione disabilitato.",
        notificationFailedUpdateVision: "Impossibile aggiornare l'impostazione della visione.",
        notificationCouldNotLoadProfileEdit: "Impossibile caricare il profilo per la modifica.",
        notificationCurrentDataDeleted: "Dati del personaggio corrente eliminati.",
        notificationFailedToDeleteData: "Impossibile eliminare i dati: {error}",
        notificationBackupCreated: "Backup per {characterName} creato con successo.",
        notificationBackupFailed: "Creazione backup fallita: {error}",
        notificationBaseBackupCreated: "File base del personaggio per '{characterName}' creato con successo.",
        notificationBaseBackupFailed: "Creazione backup base fallita: {error}",
        notificationRestoreSuccess: "Memoria per '{characterName}' (da {backupFileName}) ripristinata con successo.",
        notificationRestoreFailed: "Ripristino fallito: {error}",
        notificationSelectABackup: "Si prega di selezionare un backup.",
        notificationInvalidFileType: "Tipo di file non valido.",
        notificationFileTooLarge: "File troppo grande (max 7MB).",
        notificationSelectBackground: "Seleziona uno sfondo.",
        notificationErrorOpenModdingFolder: "Errore: Impossibile aprire la cartella modding.",
        charDeleteConfirmationTitle: "Conferma Nuova Creazione",
        charDeleteConfirmationMessage: "Questo elimina i dati del personaggio corrente.\nEsegui prima un backup se necessario.\n\nContinuare?",
    }
};

let currentLanguage = 'en'; // Default language

export function getSupportedLanguages() {
    return Object.keys(translations).map(langCode => ({
        code: langCode,
        name: langCode === 'en' ? 'English' : langCode === 'es' ? 'Español' : 'Italiano'
    }));
}

export function setCurrentLanguage(lang) {
    if (translations[lang]) {
        currentLanguage = lang;
        console.log(`UI Language set to: ${lang}`);
        // Dispatch a custom event that index.mjs can listen to for re-applying translations
        document.dispatchEvent(new CustomEvent('languageChanged'));
        return true;
    }
    console.warn(`Language ${lang} not supported. Keeping ${currentLanguage}.`);
    return false;
}

export function getCurrentLanguage() {
    return currentLanguage;
}

export function t(key, replacements = {}) {
    const langTranslations = translations[currentLanguage] || translations.en;
    let text = langTranslations[key] || translations.en[key];

    if (text === undefined) {
        console.warn(`Translation key "${key}" not found for language "${currentLanguage}" or fallback "en".`);
        text = key; // Fallback to key itself if not found even in English
    }

    // Replace placeholders like {placeholderName}
    for (const placeholder in replacements) {
        if (Object.hasOwnProperty.call(replacements, placeholder)) {
            const regex = new RegExp(`\\{${placeholder}\\}`, 'g');
            text = text.replace(regex, replacements[placeholder]);
        }
    }
    return text;
}

// For directly accessing the full set of translations for the current language
// Useful for functions in index.mjs that need to check if a key exists before translating
export function getCurrentTranslations() {
    return translations[currentLanguage] || translations.en;
}